version: '3.2'
services:
    homeassistant:
        container_name: hass
        #image: homeassistant/home-assistant:0.103.0
        image: homeassistant/home-assistant:stable
        volumes:
          - /opt/homeassistant:/config
          - /var/run/docker.sock:/var/run/docker.sock
          - /home/aneisch/.docker_pipe:/docker_pipe
          - /tmp/radar.gif:/tmp/radar.gif
        devices:
            - /dev/zwave:/dev/zwave
        environment:
          - TZ=America/Chicago
        network_mode: host
        restart: always
        logging:
          driver: none
    mosquitto:
        container_name: mosquitto
        image: eclipse-mosquitto
        volumes:
            - '/etc/ssl/certs:/mosquitto/certs:ro'
            - '/opt/mqtt/config:/mosquitto/config:ro'
            - '/opt/mqtt/log:/mosquitto/log'
            - '/opt/mqtt/data:/mosquitto/data'
        ports:
            - '1883:1883'
        restart: always
    influxdb:
        container_name: influxdb
        image: influxdb
        volumes:
            - '/opt/influxdb:/var/lib/influxdb'
        ports:
            - '8086:8086'
        restart: always
    pwr_stat:
        # https://github.com/DanielWinks/pwrstat_docker
        container_name: pwr_stat
        image: dwinks/pwrstat_docker:latest
        hostname: pwr_stat
        volumes:
            - /opt/pwr_stat/pwrstat.yaml:/pwrstat.yaml:ro
            - /opt/pwr_stat/pwrstatd.conf:/etc/pwrstatd.conf:ro
        devices:
            - '/dev/ups_monitor:/dev/usb/hiddev0'
        network_mode: host
        healthcheck:
            disable: true
        restart: always
    pwr_stat_650:
        # https://github.com/DanielWinks/pwrstat_docker
        container_name: pwr_stat_650
        image: dwinks/pwrstat_docker:latest
        hostname: pwr_stat_650
        volumes:
            - /opt/pwr_stat/pwrstat_650.yaml:/pwrstat.yaml:ro
            - /opt/pwr_stat/pwrstatd.conf:/etc/pwrstatd.conf:ro
        devices:
            - '/dev/ups_monitor_650:/dev/usb/hiddev0'
        network_mode: host
        healthcheck:
            disable: true
        restart: always
    nodered:
        container_name: nodered
        image: nodered/node-red:latest
        volumes:
          - /opt/nodered:/data
          - /etc/localtime:/etc/localtime:ro
        ports:
          - "1880:1880"
        environment:
          - TZ=America/Chicago
        restart: always
    appdaemon:
        container_name: appdaemon
        image: acockburn/appdaemon:latest
        volumes:
          - /etc/localtime:/etc/localtime
          - /opt/appdaemon:/conf
          # Mount directory of appdaemon apps installed by HACS
          - /opt/homeassistant/appdaemon/apps:/conf/apps/hacs
        ports:
            - '8888:8888'
        restart: always
    thermostat_mqtt:
        container_name: thermostat_mqtt
        image: aneisch/thermostat_mqtt_docker:latest
        environment:
          - MQTT_SERVER=10.0.1.22
          - MQTT_PORT=1883
          - THERMOSTAT_IP=10.0.0.29
        restart: always
