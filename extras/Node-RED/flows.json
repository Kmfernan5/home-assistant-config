[{"id":"9584418c.dafc2","type":"tab","label":"Automations","disabled":false,"info":""},{"id":"e1dc0b88.463bb8","type":"server","z":"","name":"Home Assistant","legacy":false,"hassio":false,"rejectUnauthorizedCerts":true,"ha_boolean":"y|yes|true|on|home|open","connectionDelay":false},{"id":"4849c0fb.bdc85","type":"api-call-service","z":"9584418c.dafc2","name":"Backlight Red","server":"e1dc0b88.463bb8","version":1,"service_domain":"scene","service":"turn_on","entityId":"scene.monitor_backlight_full_red","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1040,"y":100,"wires":[[]]},{"id":"69a050f4.ae9f8","type":"api-current-state","z":"9584418c.dafc2","name":"Is Backlight On?","server":"e1dc0b88.463bb8","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"light.andrew_monitor_backlight","state_type":"habool","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":843,"y":33,"wires":[["b8ad3ccf.32cb6"],[]]},{"id":"45d9c30e.322dfc","type":"api-current-state","z":"9584418c.dafc2","name":"Is Backlight On?","server":"e1dc0b88.463bb8","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"light.andrew_monitor_backlight","state_type":"habool","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":843,"y":101,"wires":[["4849c0fb.bdc85"],[]]},{"id":"b8ad3ccf.32cb6","type":"api-call-service","z":"9584418c.dafc2","name":"Backlight White","server":"e1dc0b88.463bb8","version":1,"service_domain":"scene","service":"turn_on","entityId":"scene.monitor_backlight_full_white","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1039,"y":31,"wires":[[]]},{"id":"9225ef03.f82cd","type":"inject","z":"9584418c.dafc2","name":"Every Hour","topic":"","payload":"","payloadType":"date","repeat":"3600","crontab":"","once":false,"onceDelay":0.1,"x":190,"y":240,"wires":[["46bca3c2.90ff9c"]]},{"id":"46bca3c2.90ff9c","type":"api-current-state","z":"9584418c.dafc2","name":"AC Filter Days Left","server":"e1dc0b88.463bb8","version":1,"outputs":1,"halt_if":"","halt_if_type":"num","halt_if_compare":"is","override_topic":false,"entity_id":"sensor.ac_filter_change","state_type":"habool","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":410.44445292154944,"y":240.11109754774304,"wires":[["34a8b34e.61c4bc"]]},{"id":"34a8b34e.61c4bc","type":"switch","z":"9584418c.dafc2","name":"Days Remaining Comparison","property":"data.attributes.days_remaining","propertyType":"msg","rules":[{"t":"lte","v":"0","vt":"num"},{"t":"lte","v":"5","vt":"num"}],"checkall":"false","repair":false,"outputs":2,"x":657.5554962158203,"y":240.00003051757812,"wires":[["f4052625.f83008"],["d28fa806.2eaca8"]]},{"id":"f4052625.f83008","type":"api-call-service","z":"9584418c.dafc2","name":"Thermostar LED Red","server":"e1dc0b88.463bb8","version":1,"service_domain":"rest_command","service":"set_thermostat_led","entityId":"","data":"{\"color\":\"red\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":944.2223052978516,"y":218.33328247070312,"wires":[[]]},{"id":"d28fa806.2eaca8","type":"api-call-service","z":"9584418c.dafc2","name":"Thermostat LED Yellow","server":"e1dc0b88.463bb8","version":1,"service_domain":"rest_command","service":"set_thermostat_led","entityId":"","data":"{\"color\":\"yellow\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":943.3332672119141,"y":267.7777404785156,"wires":[[]]},{"id":"2022689a.938918","type":"api-call-service","z":"9584418c.dafc2","name":"Pushover: Opened 1 Minute","server":"e1dc0b88.463bb8","version":1,"service_domain":"notify","service":"pushover","entityId":"","data":"{\t   \"message\": \"The \" & $lowercase(msg.data.new_state.attributes.friendly_name) & \" has been opened for 1 minute\" \t}","dataType":"jsonata","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":880,"y":440,"wires":[[]]},{"id":"8ec438b6.4eb2e8","type":"api-current-state","z":"9584418c.dafc2","name":"Door Notify On","server":"e1dc0b88.463bb8","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"input_boolean.door_notify","state_type":"habool","state_location":"","override_payload":"none","entity_location":"payload","override_data":"msg","blockInputOverrides":false,"x":540,"y":380,"wires":[["c5124616.c9bd48"],[]]},{"id":"28fa66cd.af058a","type":"trigger","z":"9584418c.dafc2","op1":"","op2":"0","op1type":"nul","op2type":"str","duration":"1","extend":false,"units":"min","reset":"","bytopic":"all","name":"Wait 1m","x":640,"y":440,"wires":[["2022689a.938918"]]},{"id":"9c1d9c7c.ed9c7","type":"change","z":"9584418c.dafc2","name":"Reset If Closed","rules":[{"t":"set","p":"reset","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":420,"y":480,"wires":[["28fa66cd.af058a"]]},{"id":"896f5b34.7b4328","type":"api-call-service","z":"9584418c.dafc2","name":"Pushover","server":"e1dc0b88.463bb8","version":1,"service_domain":"notify","service":"pushover","entityId":"","data":"{\t   \"message\": payload \t}","dataType":"jsonata","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":940,"y":380,"wires":[[]]},{"id":"4afb860e.3f6418","type":"delay","z":"9584418c.dafc2","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":404,"y":70,"wires":[["c229a5ce.6d4ad8"]]},{"id":"c5124616.c9bd48","type":"template","z":"9584418c.dafc2","name":"Opened","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{{ data.new_state.attributes.friendly_name }} opened","output":"str","x":760,"y":380,"wires":[["896f5b34.7b4328"]]},{"id":"cd0b2e22.179f9","type":"ha-api","z":"9584418c.dafc2","name":"Grab Front Image","server":"e1dc0b88.463bb8","protocol":"websocket","method":"get","path":"","data":"{\"type\":\"camera_thumbnail\",\"entity_id\":\"camera.outdoor\"}","dataType":"json","location":"image.front","locationType":"msg","responseType":"json","x":528,"y":600,"wires":[["c86a207b.69e23"]]},{"id":"bcc410c8.b6a6b","type":"inject","z":"9584418c.dafc2","name":"Every 20 Minutes During Day","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"*/20 7-17 * * *","once":false,"onceDelay":0.1,"x":250,"y":660,"wires":[["cd0b2e22.179f9","7519c5ac.36284c","d92ec36c.1f11b"]]},{"id":"c8c10914.0497a8","type":"file","z":"9584418c.dafc2","name":"Save File","filename":"","appendNewline":false,"createDir":true,"overwriteFile":"true","encoding":"base64","x":972,"y":658,"wires":[[]]},{"id":"d92ec36c.1f11b","type":"ha-api","z":"9584418c.dafc2","name":"Grab Garden Image","server":"e1dc0b88.463bb8","protocol":"websocket","method":"get","path":"","data":"{\"type\":\"camera_thumbnail\",\"entity_id\":\"camera.backyard_camera\"}","dataType":"json","location":"image.garden","locationType":"msg","responseType":"json","x":528,"y":660,"wires":[["c86a207b.69e23"]]},{"id":"7519c5ac.36284c","type":"ha-api","z":"9584418c.dafc2","name":"Grab Side Image","server":"e1dc0b88.463bb8","protocol":"websocket","method":"get","path":"","data":"{\"type\":\"camera_thumbnail\",\"entity_id\":\"camera.esp_camera\"}","dataType":"json","location":"image.side","locationType":"msg","responseType":"json","x":528,"y":720,"wires":[["c86a207b.69e23"]]},{"id":"c86a207b.69e23","type":"function","z":"9584418c.dafc2","name":"Create msg object","func":"var name = Object.keys(msg.image)[0]\nvar content = Object.values(msg.image)[0].content\nmsg = {\n    filename: `/data/${name}_timelapse/${name}_${Date.now()}.jpg`,\n    payload: content\n}\nreturn msg;","outputs":1,"noerr":0,"x":772,"y":658,"wires":[["c8c10914.0497a8"]]},{"id":"f9d93af6.184028","type":"server-state-changed","z":"9584418c.dafc2","name":"Door Opened","server":"e1dc0b88.463bb8","version":1,"entityidfilter":"binary_sensor.*_door","entityidfiltertype":"regex","outputinitially":false,"state_type":"habool","haltifstate":"true","halt_if_type":"bool","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":170,"y":420,"wires":[["8ec438b6.4eb2e8","28fa66cd.af058a"],["9c1d9c7c.ed9c7"]]},{"id":"42796298.a0104c","type":"api-current-state","z":"9584418c.dafc2","name":"Heading Comparison","server":"e1dc0b88.463bb8","version":1,"outputs":1,"halt_if":"","halt_if_type":"jsonata","halt_if_compare":"jsonata","override_topic":false,"entity_id":"binary_sensor.gate_heading_comparison","state_type":"habool","state_location":"","override_payload":"msg","entity_location":"","override_data":"msg","blockInputOverrides":false,"x":520,"y":960,"wires":[["115d9f48.071141"]]},{"id":"222ebf24.bfbfa","type":"inject","z":"9584418c.dafc2","name":"Every Hour","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"0 0-23 * * *","once":false,"onceDelay":0.1,"x":190,"y":900,"wires":[["6bfa6030.1f0d","b80db559.a623b8","3b804cf9.ada174"]]},{"id":"115d9f48.071141","type":"switch","z":"9584418c.dafc2","name":"Last Changed > 4 hours","property":"data.timeSinceChangedMs","propertyType":"msg","rules":[{"t":"gt","v":"14400000","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":690,"y":900,"wires":[["1eab32fa.1312bd"]]},{"id":"1eab32fa.1312bd","type":"function","z":"9584418c.dafc2","name":"Create msg object","func":"var last_time = msg.data.timeSinceChangedMs\n\nfunction msToTime(duration) {\n  var milliseconds = parseInt((duration % 1000) / 100),\n    seconds = Math.floor((duration / 1000) % 60),\n    minutes = Math.floor((duration / (1000 * 60)) % 60),\n    hours = Math.floor((duration / (1000 * 60 * 60)) % 24);\n\n  hours = (hours < 10) ? \"0\" + hours : hours;\n  minutes = (minutes < 10) ? \"0\" + minutes : minutes;\n  seconds = (seconds < 10) ? \"0\" + seconds : seconds;\n\n  return hours + \":\" + minutes + \":\" + seconds + \".\" + milliseconds;\n}\n\nvar message = msg.data.entity_id + \" last changed \" +  msToTime(last_time) + \" ago\"\n\nreturn { payload: message,topic:msg.topic };","outputs":1,"noerr":0,"x":930,"y":900,"wires":[["c444f1de.8365f"]]},{"id":"c444f1de.8365f","type":"api-call-service","z":"9584418c.dafc2","name":"Pushover","server":"e1dc0b88.463bb8","version":1,"service_domain":"notify","service":"pushover","entityId":"","data":"{\t   \"message\": payload \t}","dataType":"jsonata","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1120,"y":920,"wires":[[]]},{"id":"c229a5ce.6d4ad8","type":"api-current-state","z":"9584418c.dafc2","name":"Internet Reachable?","server":"e1dc0b88.463bb8","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"binary_sensor.internet_reachability","state_type":"habool","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":612,"y":70,"wires":[["69a050f4.ae9f8"],["45d9c30e.322dfc"]]},{"id":"a8e07bf8.32b8b8","type":"server-state-changed","z":"9584418c.dafc2","name":"Internet Reachable?","server":"e1dc0b88.463bb8","version":1,"entityidfilter":"binary_sensor.internet_reachability","entityidfiltertype":"exact","outputinitially":false,"state_type":"habool","haltifstate":"true","halt_if_type":"bool","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":194,"y":70,"wires":[["4afb860e.3f6418"],["4afb860e.3f6418"]]},{"id":"9aee0f4b.44e93","type":"trigger-state","z":"9584418c.dafc2","name":"Gate Offline/Online","server":"e1dc0b88.463bb8","entityid":"sensor.gate_online_offline","entityidfiltertype":"exact","debugenabled":false,"constraints":[],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":450,"y":1020,"wires":[["cc1f97c7.911bf8"],[]]},{"id":"1fdf1fb6.8cd5d","type":"function","z":"9584418c.dafc2","name":"Create msg object","func":"var message = \"Gate reports \" + msg.payload + \"..\"\n\nreturn { payload: message,topic:msg.topic };","outputs":1,"noerr":0,"x":930,"y":940,"wires":[["c444f1de.8365f"]]},{"id":"3b804cf9.ada174","type":"api-current-state","z":"9584418c.dafc2","name":"Gate Alert On","server":"e1dc0b88.463bb8","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"input_boolean.gate_alert","state_type":"habool","state_location":"","override_payload":"none","entity_location":"payload","override_data":"msg","blockInputOverrides":false,"x":300,"y":960,"wires":[["42796298.a0104c"],[]]},{"id":"cc1f97c7.911bf8","type":"api-current-state","z":"9584418c.dafc2","name":"Gate Alert On","server":"e1dc0b88.463bb8","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"input_boolean.gate_alert","state_type":"habool","state_location":"","override_payload":"none","entity_location":"payload","override_data":"msg","blockInputOverrides":false,"x":740,"y":980,"wires":[["1fdf1fb6.8cd5d"],[]]},{"id":"b80db559.a623b8","type":"api-current-state","z":"9584418c.dafc2","name":"650 UPS Line Voltage","server":"e1dc0b88.463bb8","version":1,"outputs":1,"halt_if":"","halt_if_type":"jsonata","halt_if_compare":"jsonata","override_topic":false,"entity_id":"sensor.650_ups_input_voltage","state_type":"habool","state_location":"","override_payload":"msg","entity_location":"","override_data":"msg","blockInputOverrides":false,"x":440,"y":840,"wires":[["115d9f48.071141"]]},{"id":"6bfa6030.1f0d","type":"api-current-state","z":"9584418c.dafc2","name":"UPS Line Voltage","server":"e1dc0b88.463bb8","version":1,"outputs":1,"halt_if":"","halt_if_type":"jsonata","halt_if_compare":"jsonata","override_topic":false,"entity_id":"sensor.ups_input_voltage","state_type":"habool","state_location":"","override_payload":"msg","entity_location":"","override_data":"msg","blockInputOverrides":false,"x":430,"y":900,"wires":[["115d9f48.071141"]]}]