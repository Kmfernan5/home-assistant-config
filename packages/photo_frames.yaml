# https://gist.github.com/aneisch/15fa9691ce95431f9be155a432514304

automation:
  - alias: "Start Fotoo"
    id: start_fotoo
    mode: "parallel"
    trigger:
      - platform: state
        entity_id: media_player.office_photo_frame
        from: "unavailable"
      - platform: state
        entity_id: media_player.kitchen_photo_frame
        from: "unavailable"
      - platform: state
        entity_id: 
        from: "unavailable"
    action:
      - service: script.photo_frame_launch_fotoo
        data:
          entity_id: "{{ trigger.entity_id }}"

  - alias: "Photo Frames on when MacBook Active"
    id: "photo_frames_macbook_active"
    initial_state: on
    trigger:
      platform: state
      entity_id: binary_sensor.weasel_active
      to: "on"
    condition: "{{ states('person.andrew') == 'home' }}"
    action:
      - service: homeassistant.turn_on
        entity_id:
        - switch.andrew_monitor
        - media_player.kitchen_photo_frame
        - media_player.office_photo_frame
        - media_player.misc_photo_frame

script:
  photo_frame_launch_fotoo:
    sequence:
      - service: androidtv.adb_command
        target:
          entity_id: "{{ entity_id }}"
        data:
          command: "am start com.bo.fotoo/com.bo.fotoo.ui.home.FTHomeActivity"

  photo_frame_launch_ha_dashboard:
    mode: 'restart'
    sequence:
      - service: androidtv.adb_command
        target:
          entity_id: "{{ entity_id }}"
        data:
          command: "am start -a android.intent.action.VIEW -d 'http://10.0.1.22:8123'"
      - delay: "00:30:00"
      - service: script.photo_frame_launch_fotoo
        data:
          entity_id: "{{ entity_id }}"

  photo_frame_launch_spotify:
    mode: 'restart'
    sequence:
      - service: androidtv.adb_command
        target:
          entity_id: "{{ entity_id }}"
        data:
          command: "am start com.spotify.music"
      - delay: "{{ delay | default('00:30:00')}}" # If we launch it manually, time out after 30 minutes by default. Override by passing delay to this service
      - service: script.photo_frame_launch_fotoo
        data:
          entity_id: "{{ entity_id }}"

  photo_frame_launch_front_door_stream:
    mode: 'restart'
    sequence:
      - variables:
          token: "{{ state_attr('camera.front_door_test','access_token')}}"
      - service: androidtv.adb_command
        target:
          entity_id: "{{ entity_id }}"
        data:
          command: "am start -a android.intent.action.VIEW -d 'http://10.0.1.22:8123/api/camera_proxy_stream/camera.front_door_test?token={{ token }}'"
      - delay: "{{ delay | default('00:30:00')}}" # If we launch it manually, time out after 30 minutes by default. Override by passing delay to this service
      - service: script.photo_frame_launch_fotoo
        data:
          entity_id: "{{ entity_id }}"

  photo_frame_launch_url:
    mode: 'restart'
    sequence:
      - service: androidtv.adb_command
        target:
          entity_id: "{{ entity_id }}"
        data:
          command: "am start -a android.intent.action.VIEW -d '{{ states('input_text.kitchen_frame_url') }}'"
      - delay: "{{ delay | default('00:30:00')}}" # Time out after 30 minutes by default. Override by passing delay to this service
      - service: script.photo_frame_launch_fotoo
        data:
          entity_id: "{{ entity_id }}"

  photo_frame_launch_timers:
    mode: 'restart'
    sequence:
      - service: androidtv.adb_command
        target:
          entity_id: "{{ entity_id }}"
        data:
          command: "adb shell am start -n com.android.chrome/com.google.android.apps.chrome.Main -a android.intent.action.VIEW -d 'http://10.0.1.22:8123/lovelace/timers?wp_enabled=true'"